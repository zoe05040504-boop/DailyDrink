<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘è¶…æ„›å–æ‰‹æ–</title>
    
    <!-- PWA Setup for Home Screen -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="æˆ‘è¶…æ„›å–æ‰‹æ–">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/3063/3063822.png">
    
    <!-- Manifest for Android/Chrome -->
    <link rel="manifest" href="data:application/manifest+json,{'name':'æˆ‘è¶…æ„›å–æ‰‹æ–','short_name':'æ‰‹æ–çµ±è¨ˆ','start_url':'.','display':'standalone','background_color':'#FDFCFE','theme_color':'#FFDDE2'}">

    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --m-pink: #FFDDE2;
            --m-purple: #E8DFF5;
            --m-blue: #D6EDFA;
            --m-text: #6D5D6E;
            --m-border: #F3EBF6;
            --m-red: #FF8A8A;
            --m-drink: #9B72AA; /* é è¨­åœ–ç¤ºé¡è‰² */
        }

        body {
            background-color: #FDFCFE;
            font-family: "Microsoft JhengHei", "PingFang TC", sans-serif;
            color: var(--m-text);
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        .card-main {
            background: white;
            border-radius: 24px;
            box-shadow: 0 10px 30px rgba(232, 223, 245, 0.4);
            border: 2px solid var(--m-border);
        }

        .calendar-day {
            aspect-ratio: 1/1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding-top: 6px;
            cursor: pointer;
            border-radius: 16px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            background: #fff;
            font-weight: 500;
        }

        .calendar-day.active {
            background: linear-gradient(135deg, var(--m-pink), var(--m-purple));
            color: #7d5a5a;
            box-shadow: 0 4px 12px rgba(255, 221, 226, 0.6);
        }

        /* é£²æ–™åœ–ç¤ºå®¹å™¨ */
        .drink-icon-wrapper {
            display: flex;
            gap: 2px;
            margin-top: 2px;
            opacity: 0.8;
        }

        /* ç•¶å¤©è¢«é¸ä¸­æ™‚ï¼Œåœ–ç¤ºé¡è‰²å¾®èª¿ä»¥æ­é…èƒŒæ™¯ */
        .calendar-day.active .drink-icon-wrapper svg {
            fill: #7d5a5a;
        }

        .option-btn {
            padding: 6px 12px;
            border-radius: 10px;
            font-size: 13px;
            border: 1px solid #F0F0F0;
            background: #FAFAFA;
            transition: 0.2s;
        }

        .option-btn.selected-pink { background-color: var(--m-pink); border-color: #FFB7C5; }
        .option-btn.selected-purple { background-color: var(--m-purple); border-color: #D1C4E9; }
        .option-btn.selected-blue { background-color: var(--m-blue); border-color: #AED9F4; }

        .stat-card-large {
            background: white;
            padding: 24px;
            border-radius: 24px;
            text-align: center;
            border: 2px solid var(--m-border);
            box-shadow: 0 4px 15px rgba(232, 223, 245, 0.2);
        }

        .stat-card-small {
            background: white;
            padding: 12px;
            border-radius: 16px;
            text-align: center;
            border: 1px solid var(--m-border);
        }

        #modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(109, 93, 110, 0.4);
            backdrop-filter: blur(8px);
            z-index: 100;
            justify-content: center;
            align-items: center;
            padding: 16px;
        }

        .btn-delete {
            background-color: var(--m-red);
            color: white;
            transition: all 0.2s;
        }
        .btn-delete:hover {
            background-color: #FF5C5C;
            transform: scale(1.02);
        }

        .clear-cup-btn {
            color: var(--m-red);
            font-size: 11px;
            text-decoration: underline;
            cursor: pointer;
        }

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: var(--m-purple); border-radius: 10px; }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-4xl mx-auto">
        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-3xl font-black tracking-tight" style="color: #9B72AA;">
                ğŸ¥¤ æˆ‘è¶…æ„›å–æ‰‹æ– <span class="text-lg font-normal opacity-60">2026</span>
            </h1>
            <p class="text-sm text-gray-400 mt-1">ç´€éŒ„æ¯ä¸€å£å¹¸ç¦ï¼Œçµ±è¨ˆæ¯ä¸€ä»½ç”œèœœ</p>
        </header>

        <!-- Main Dashboard -->
        <div class="space-y-4 mb-10">
            <!-- Row 1: Large Stats -->
            <div class="grid grid-cols-2 gap-4">
                <div class="stat-card-large">
                    <p class="text-[10px] uppercase tracking-widest text-gray-400 mb-2">Favorite Store</p>
                    <p class="text-xl md:text-2xl font-bold truncate px-2" id="stat-fav-store" style="color: #9B72AA;">-</p>
                    <p class="text-xs text-gray-300 mt-1">æœ€æ„›åº—å®¶</p>
                </div>
                <div class="stat-card-large">
                    <p class="text-[10px] uppercase tracking-widest text-gray-400 mb-2">Favorite Drink</p>
                    <p class="text-xl md:text-2xl font-bold truncate px-2" id="stat-fav-item" style="color: #FF9AA2;">-</p>
                    <p class="text-xs text-gray-300 mt-1">æœ€æ„›å“é …</p>
                </div>
            </div>

            <!-- Row 2: Small Stats -->
            <div class="grid grid-cols-3 gap-3">
                <div class="stat-card-small">
                    <p class="text-[9px] uppercase tracking-widest text-gray-400 mb-1">Total Cups</p>
                    <p class="text-lg font-bold text-pink-400" id="stat-total-cups">0</p>
                    <p class="text-[9px] text-gray-300">ç¸½æ¯æ•¸</p>
                </div>
                <div class="stat-card-small">
                    <p class="text-[9px] uppercase tracking-widest text-gray-400 mb-1">Total Spent</p>
                    <p class="text-lg font-bold text-purple-400" id="stat-total-cost">$0</p>
                    <p class="text-[9px] text-gray-300">ç¸½é‡‘é¡</p>
                </div>
                <div class="stat-card-small">
                    <p class="text-[9px] uppercase tracking-widest text-gray-400 mb-1">Avg Price</p>
                    <p class="text-lg font-bold text-blue-400" id="stat-avg-price">$0</p>
                    <p class="text-[9px] text-gray-300">å¹³å‡å–®åƒ¹</p>
                </div>
            </div>
        </div>

        <!-- Calendar Section -->
        <div class="card-main p-6 md:p-10 mb-8">
            <div class="flex justify-between items-center mb-8">
                <button onclick="changeMonth(-1)" class="w-10 h-10 flex items-center justify-center rounded-full hover:bg-gray-100 transition">â®</button>
                <h2 class="text-xl font-bold text-gray-600" id="calendar-title">2026å¹´ 1æœˆ</h2>
                <button onclick="changeMonth(1)" class="w-10 h-10 flex items-center justify-center rounded-full hover:bg-gray-100 transition">â¯</button>
            </div>
            <div class="grid grid-cols-7 gap-3 mb-4 text-center text-[10px] font-bold text-gray-300 uppercase tracking-widest">
                <div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div>
            </div>
            <div id="calendar-grid" class="grid grid-cols-7 gap-3 md:gap-5 text-sm"></div>
        </div>

        <!-- Footer Actions -->
        <div class="flex justify-center gap-4 pb-10">
            <button onclick="exportData()" class="text-xs text-gray-300 hover:text-purple-300 transition underline decoration-dotted">å‚™ä»½è³‡æ–™ (JSON)</button>
        </div>
    </div>

    <!-- Edit Modal -->
    <div id="modal">
        <div class="bg-white rounded-[32px] p-8 w-full max-w-lg shadow-2xl relative">
            <button onclick="closeModal()" class="absolute top-6 right-6 text-gray-300 hover:text-gray-500 text-2xl">&times;</button>
            
            <div class="mb-6">
                <h2 class="text-2xl font-black text-gray-700" id="modal-date-title">2026 / 01 / 01</h2>
                <div class="h-1 w-12 bg-pink-200 mt-1 rounded-full"></div>
            </div>
            
            <div class="space-y-8 max-h-[60vh] overflow-y-auto px-1">
                <!-- Cup 1 -->
                <section id="cup-section-1">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center gap-2">
                            <div class="w-8 h-8 rounded-full flex items-center justify-center text-sm" style="background-color: var(--m-blue);">1</div>
                            <h3 class="font-bold text-blue-400">ç¬¬ä¸€æ¯</h3>
                        </div>
                        <span class="clear-cup-btn" onclick="clearCup(1)">æ¸…é™¤æ­¤æ¯</span>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-3 mb-4">
                        <input type="text" id="store-1" placeholder="åº—å®¶åç¨±" class="w-full p-3 rounded-xl bg-gray-50 border-none outline-none text-sm focus:ring-2 focus:ring-blue-200">
                        <input type="text" id="item-1" placeholder="é£²å“å“é …" class="w-full p-3 rounded-xl bg-gray-50 border-none outline-none text-sm focus:ring-2 focus:ring-blue-200">
                    </div>

                    <div class="mb-4">
                        <label class="block text-xs font-bold text-gray-400 mb-2">å†°å¡Š Ice</label>
                        <div class="flex flex-wrap gap-2" id="ice-options-1">
                            <button class="option-btn" onclick="setOpt('ice', 1, 'æ­£å¸¸')">æ­£å¸¸</button>
                            <button class="option-btn" onclick="setOpt('ice', 1, 'å°‘å†°')">å°‘å†°</button>
                            <button class="option-btn" onclick="setOpt('ice', 1, 'å¾®å†°')">å¾®å†°</button>
                            <button class="option-btn" onclick="setOpt('ice', 1, 'å»å†°')">å»å†°</button>
                            <button class="option-btn" onclick="setOpt('ice', 1, 'å¸¸æº«')">å¸¸æº«</button>
                            <button class="option-btn" onclick="setOpt('ice', 1, 'æº«')">æº«</button>
                            <button class="option-btn" onclick="setOpt('ice', 1, 'ç„¡æ³•èª¿æ•´')">ç„¡æ³•èª¿æ•´</button>
                        </div>
                    </div>

                    <div class="mb-4">
                        <label class="block text-xs font-bold text-gray-400 mb-2">ç”œåº¦ Sugar</label>
                        <div class="flex flex-wrap gap-2" id="sugar-options-1">
                            <button class="option-btn" onclick="setOpt('sugar', 1, 'å…¨ç³–')">å…¨ç³–</button>
                            <button class="option-btn" onclick="setOpt('sugar', 1, 'å°‘ç³–')">å°‘ç³–</button>
                            <button class="option-btn" onclick="setOpt('sugar', 1, 'åŠç³–')">åŠç³–</button>
                            <button class="option-btn" onclick="setOpt('sugar', 1, 'å¾®ç³–')">å¾®ç³–</button>
                            <button class="option-btn" onclick="setOpt('sugar', 1, 'ä¸€åˆ†ç³–')">ä¸€åˆ†ç³–</button>
                            <button class="option-btn" onclick="setOpt('sugar', 1, 'ç„¡ç³–')">ç„¡ç³–</button>
                            <button class="option-btn" onclick="setOpt('sugar', 1, 'ç„¡æ³•èª¿æ•´')">ç„¡æ³•èª¿æ•´</button>
                        </div>
                    </div>

                    <div class="relative w-32">
                        <span class="absolute left-3 top-3 text-gray-400 text-sm">$</span>
                        <input type="number" id="price-1" placeholder="0" class="w-full p-3 pl-7 rounded-xl bg-gray-50 border-none outline-none text-sm focus:ring-2 focus:ring-blue-200">
                    </div>
                </section>

                <hr class="border-gray-50">

                <!-- Cup 2 -->
                <section id="cup-section-2">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center gap-2">
                            <div class="w-8 h-8 rounded-full flex items-center justify-center text-sm" style="background-color: var(--m-pink);">2</div>
                            <h3 class="font-bold text-pink-400">ç¬¬äºŒæ¯</h3>
                        </div>
                        <span class="clear-cup-btn" onclick="clearCup(2)">æ¸…é™¤æ­¤æ¯</span>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-3 mb-4">
                        <input type="text" id="store-2" placeholder="åº—å®¶åç¨±" class="w-full p-3 rounded-xl bg-gray-50 border-none outline-none text-sm focus:ring-2 focus:ring-pink-200">
                        <input type="text" id="item-2" placeholder="é£²å“å“é …" class="w-full p-3 rounded-xl bg-gray-50 border-none outline-none text-sm focus:ring-2 focus:ring-pink-200">
                    </div>

                    <div class="mb-4">
                        <label class="block text-xs font-bold text-gray-400 mb-2">å†°å¡Š Ice</label>
                        <div class="flex flex-wrap gap-2" id="ice-options-2">
                            <button class="option-btn" onclick="setOpt('ice', 2, 'æ­£å¸¸')">æ­£å¸¸</button>
                            <button class="option-btn" onclick="setOpt('ice', 2, 'å°‘å†°')">å°‘å†°</button>
                            <button class="option-btn" onclick="setOpt('ice', 2, 'å¾®å†°')">å¾®å†°</button>
                            <button class="option-btn" onclick="setOpt('ice', 2, 'å»å†°')">å»å†°</button>
                            <button class="option-btn" onclick="setOpt('ice', 2, 'å¸¸æº«')">å¸¸æº«</button>
                            <button class="option-btn" onclick="setOpt('ice', 2, 'æº«')">æº«</button>
                            <button class="option-btn" onclick="setOpt('ice', 2, 'ç„¡æ³•èª¿æ•´')">ç„¡æ³•èª¿æ•´</button>
                        </div>
                    </div>

                    <div class="mb-4">
                        <label class="block text-xs font-bold text-gray-400 mb-2">ç”œåº¦ Sugar</label>
                        <div class="flex flex-wrap gap-2" id="sugar-options-2">
                            <button class="option-btn" onclick="setOpt('sugar', 2, 'å…¨ç³–')">å…¨ç³–</button>
                            <button class="option-btn" onclick="setOpt('sugar', 2, 'å°‘ç³–')">å°‘ç³–</button>
                            <button class="option-btn" onclick="setOpt('sugar', 2, 'åŠç³–')">åŠç³–</button>
                            <button class="option-btn" onclick="setOpt('sugar', 2, 'å¾®ç³–')">å¾®ç³–</button>
                            <button class="option-btn" onclick="setOpt('sugar', 2, 'ä¸€åˆ†ç³–')">ä¸€åˆ†ç³–</button>
                            <button class="option-btn" onclick="setOpt('sugar', 2, 'ç„¡ç³–') )">ç„¡ç³–</button>
                            <button class="option-btn" onclick="setOpt('sugar', 2, 'ç„¡æ³•èª¿æ•´')">ç„¡æ³•èª¿æ•´</button>
                        </div>
                    </div>

                    <div class="relative w-32">
                        <span class="absolute left-3 top-3 text-gray-400 text-sm">$</span>
                        <input type="number" id="price-2" placeholder="0" class="w-full p-3 pl-7 rounded-xl bg-gray-50 border-none outline-none text-sm focus:ring-2 focus:ring-pink-200">
                    </div>
                </section>
            </div>

            <div class="mt-8 flex gap-3">
                <button onclick="saveData()" class="flex-[2] bg-purple-400 hover:bg-purple-500 text-white font-bold py-4 rounded-2xl transition shadow-lg shadow-purple-100">å„²å­˜ç´€éŒ„</button>
                <button onclick="deleteFullDay()" class="flex-1 btn-delete font-bold py-4 rounded-2xl">åˆªé™¤ Delete</button>
            </div>
        </div>
    </div>

    <script>
        const DB_KEY = 'drink_tracker_2026_red_del';
        let drinkData = JSON.parse(localStorage.getItem(DB_KEY)) || {};
        let currentYear = 2026;
        let currentMonth = 0;
        let selectedDate = "";
        let selections = { ice1: "", ice2: "", sugar1: "", sugar2: "" };

        // è‡ªå®šç¾© SVG é£²æ–™æ¯åœ–æ¡ˆ
        const DRINK_SVG = `
            <svg width="14" height="14" viewBox="0 0 24 24" fill="#9B72AA" xmlns="http://www.w3.org/2000/svg">
                <path d="M17 5L18.41 2H19.5L18.09 5H21V7H3V5H17Z" />
                <path d="M5 9L6.5 22H17.5L19 9H5Z" />
            </svg>
        `;

        function init() {
            renderCalendar();
            updateStats();
        }

        function renderCalendar() {
            const grid = document.getElementById('calendar-grid');
            grid.innerHTML = "";
            document.getElementById('calendar-title').innerText = `${currentYear}å¹´ ${currentMonth + 1}æœˆ`;

            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();

            for (let i = 0; i < firstDay; i++) grid.innerHTML += `<div></div>`;

            for (let day = 1; day <= daysInMonth; day++) {
                const dateStr = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const cups = (drinkData[dateStr] && drinkData[dateStr].cups) || [];
                const cupCount = cups.length;
                
                const dayEl = document.createElement('div');
                dayEl.className = `calendar-day ${dateStr === selectedDate ? 'active' : ''}`;
                
                let iconsHtml = '';
                if (cupCount > 0) {
                    iconsHtml = '<div class="drink-icon-wrapper">';
                    for(let k=0; k<cupCount; k++) {
                        iconsHtml += DRINK_SVG;
                    }
                    iconsHtml += '</div>';
                }

                dayEl.innerHTML = `<span>${day}</span>${iconsHtml}`;
                dayEl.onclick = () => openModal(dateStr);
                grid.appendChild(dayEl);
            }
        }

        function changeMonth(diff) {
            currentMonth += diff;
            if (currentMonth > 11) { currentMonth = 0; currentYear++; }
            if (currentMonth < 0) { currentMonth = 11; currentYear--; }
            renderCalendar();
        }

        function openModal(dateStr) {
            selectedDate = dateStr;
            document.getElementById('modal-date-title').innerText = dateStr.replace(/-/g, ' / ');
            document.getElementById('modal').style.display = 'flex';
            
            clearInputFields();

            if (drinkData[dateStr]) {
                drinkData[dateStr].cups.forEach((cup, idx) => {
                    const i = idx + 1;
                    document.getElementById(`store-${i}`).value = cup.store || "";
                    document.getElementById(`item-${i}`).value = cup.item || "";
                    document.getElementById(`price-${i}`).value = cup.price || "";
                    selections[`ice${i}`] = cup.ice || "";
                    selections[`sugar${i}`] = cup.sugar || "";
                });
            }
            updateBtnUI();
            renderCalendar();
        }

        function clearInputFields() {
            for (let i = 1; i <= 2; i++) {
                document.getElementById(`store-${i}`).value = "";
                document.getElementById(`item-${i}`).value = "";
                document.getElementById(`price-${i}`).value = "";
            }
            selections = { ice1: "", ice2: "", sugar1: "", sugar2: "" };
        }

        function closeModal() { document.getElementById('modal').style.display = 'none'; }

        function setOpt(type, cupIdx, val) {
            selections[`${type}${cupIdx}`] = val;
            updateBtnUI();
        }

        function updateBtnUI() {
            [1, 2].forEach(i => {
                document.querySelectorAll(`#ice-options-${i} .option-btn`).forEach(b => b.classList.toggle(i===1?'selected-blue':'selected-pink', b.innerText === selections[`ice${i}`]));
                document.querySelectorAll(`#sugar-options-${i} .option-btn`).forEach(b => b.classList.toggle('selected-purple', b.innerText === selections[`sugar${i}`]));
            });
        }

        function clearCup(i) {
            document.getElementById(`store-${i}`).value = "";
            document.getElementById(`item-${i}`).value = "";
            document.getElementById(`price-${i}`).value = "";
            selections[`ice${i}`] = "";
            selections[`sugar${i}`] = "";
            updateBtnUI();
        }

        function saveData() {
            const cups = [];
            for (let i = 1; i <= 2; i++) {
                const store = document.getElementById(`store-${i}`).value.trim();
                const item = document.getElementById(`item-${i}`).value.trim();
                const price = parseFloat(document.getElementById(`price-${i}`).value) || 0;
                if (store || item || price > 0) {
                    cups.push({ store, item, ice: selections[`ice${i}`], sugar: selections[`sugar${i}`], price });
                }
            }
            if (cups.length > 0) drinkData[selectedDate] = { cups };
            else delete drinkData[selectedDate];

            persist();
        }

        function deleteFullDay() {
            if (confirm("ç¢ºå®šè¦åˆªé™¤é€™å¤©çš„ç´€éŒ„å—ï¼Ÿ")) {
                delete drinkData[selectedDate];
                persist();
            }
        }

        function persist() {
            localStorage.setItem(DB_KEY, JSON.stringify(drinkData));
            closeModal();
            updateStats();
            renderCalendar();
        }

        function updateStats() {
            let totalCups = 0, totalCost = 0;
            const stores = {}, items = {};
            Object.keys(drinkData).forEach(date => {
                drinkData[date].cups.forEach(cup => {
                    totalCups++;
                    totalCost += cup.price;
                    if (cup.store) stores[cup.store] = (stores[cup.store] || 0) + 1;
                    if (cup.item) items[cup.item] = (items[cup.item] || 0) + 1;
                });
            });

            document.getElementById('stat-total-cups').innerText = totalCups;
            document.getElementById('stat-total-cost').innerText = `$${Math.round(totalCost)}`;
            document.getElementById('stat-avg-price').innerText = totalCups > 0 ? `$${Math.round(totalCost/totalCups)}` : "$0";
            
            const topStore = Object.entries(stores).sort((a,b)=>b[1]-a[1])[0];
            document.getElementById('stat-fav-store').innerText = topStore ? topStore[0] : "-";
            
            const topItem = Object.entries(items).sort((a,b)=>b[1]-a[1])[0];
            document.getElementById('stat-fav-item').innerText = topItem ? topItem[0] : "-";
        }

        function exportData() {
            const blob = new Blob([JSON.stringify(drinkData, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url; a.download = 'my_drinks_backup.json'; a.click();
        }

        window.onload = init;
    </script>
</body>
</html>